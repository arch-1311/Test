<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chennai Metro Fare Calculator</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="icon" href="favicon.png" type="image/x-icon">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Scroll-up button styles */
        #scrollUpBtn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: none;
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            z-index: 999;
        }
        .table-bordered tr,
        .table-bordered th,
        .table-bordered td {
            border: 1px solid black; /* Black border for table cells */
        }
        .dark-mode .disc-table  {
            color : white;
        }
    </style>
    <link href="styles.css" rel="stylesheet">
</head>
<body>
    <div class="container" style="max-width: 800px;">
        <div class="text-center">
            <a href="index.html">
                <img id="banner-image" src="NOC2024bg.png" alt="Banner" class="img-fluid banner-img" />
            </a>
            <div class="top-ribbon">
                <a href="index.html" class="btn icon-circle" aria-label="Home">
                    <i class="fas fa-home"></i>
                </a>
                <a href="metro-fare-ta.html" class="btn icon-circle" style="white-space: nowrap;">தமிழ் பதிப்பு</i>
                </a>
                <button class="btn icon-circle" id="theme-toggle" aria-label="Toggle Dark Mode">
                    <i id="theme-icon" class="fas fa-moon"></i>
                </button>
                <!-- <a class="btn icon-circle" href="https://www.instagram.com/newsofchennai/" target="_blank"><i class="fab fa-instagram"></i></a>
                <a class="btn icon-circle" href="https://www.facebook.com/newsofchennai" target="_blank"><i class="fab fa-facebook"></i></a>
                <a class="btn icon-circle" href="https://x.com/newsofchennai" target="_blank"><i class="fab fa-twitter"></i></a> -->                
            </div>
        </div>
        <div>
            <img class="rotating-globe" src="globe.gif" 
                 alt="rotating globe" loading="lazy" width="12" height="12" decoding="async">
            <span class="date-time" id="date-time"></span>
        </div> 
        <hr>
        <div class="container mt-2">
            <h4 class="text-center mb-4">Chennai Metro Fare Calculator</h4>
        
            <!-- From Station Dropdown -->
            <div class="mb-3 text-left">
                <!-- <label for="fromStation" class="form-label">From Station</label> -->
                <select id="fromStation" class="form-select">
                    <option value="" disabled selected>From Station</option>
                </select>
            </div>
        
            <!-- To Station Dropdown -->
            <div class="mb-3 text-left">
                <!-- <label for="toStation" class="form-label">To Station</label> -->
                <select id="toStation" class="form-select">
                    <option value="" disabled selected>To station</option>
                </select>
            </div>
            
            <!-- Fare Output -->
            <div class="mt-5" id="fareOutput" class="hidden"></div>
            
            <!-- Route Details -->
            <div class="mt-4" id="routeDetails" class="hidden">
                <h5>Route Details</h5>
                <ul id="routeList" class="list-group"></ul>
            </div>
            <hr>            
        </div>
        <!-- Scroll Up Button -->
        <button id="scrollUpBtn" onclick="scrollToTop()">
            <i class="fas fa-arrow-up"></i>
        </button>
        </div>
       
        
<script src="script.js"></script>
<!-- Bootstrap JS and Popper.js -->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>


<script>
// Lines Data
const blueLine = [
    "Wimco Nagar Depot", "Wimco Nagar", "Thiruvottriyur", "Thiruvottriyur Theradi",
    "Kaladipet", "Tollgate", "New Washermanpet", "Tondiarpet",
    "Sir Theagaraya College", "Washermanpet", "Mannadi", "High Court",
    "MGR Central (Chennai Central)", "Government Estate", "LIC",
    "Thousand Lights", "AG DMS", "Teynampet", "Nandanam", "Saidapet",
    "Little Mount", "Guindy", "Arignar Anna Alandur", "Nanganallur Road",
    "Meenambakkam", "Chennai International Airport"
];

const greenLine = [
    "MGR Central (Chennai Central)", "Egmore", "Nehru Park", "Kilpauk Medical College",
    "Pachaiyappa College", "Shenoy Nagar", "Anna Nagar East", "Anna Nagar Tower",
    "Thirumangalam", "Koyambedu", "CMBT", "Arumbakkam", "Vadapalani",
    "Ashok Nagar", "Ekkattuthangal", "Arignar Anna Alandur", "St Thomas Mount"
];

const interchanges = ["MGR Central (Chennai Central)", "Arignar Anna Alandur"];

/**
 * Function to display route details in the DOM
 * @param {string} fromStation - Starting station
 * @param {string} toStation - Ending station
 */
 function displayRouteDetails(fromStation, toStation) {
    const routeDetailsDiv = document.getElementById("routeDetails");
    const routeList = document.getElementById("routeList");

    const stationsBetween = getStationsBetweenAcrossLines(fromStation, toStation);

    if (typeof stationsBetween === "string") {
        // Error case: Invalid station selection or no valid interchange
        routeDetailsDiv.classList.remove('hidden');
        routeList.innerHTML = `<li class="list-group-item text-danger">${stationsBetween}</li>`;
        return;
    }

    // Clear and populate the route list
    routeList.innerHTML = "";
    stationsBetween.forEach((station, index) => {
        const li = document.createElement("li");
        li.className = "list-group-item";
        li.innerText = `${index + 1}. ${station}`;
        routeList.appendChild(li);
    });

    // Show the route details div
    routeDetailsDiv.classList.remove('hidden');
}

function getStationsBetweenAcrossLines(from, to) {
    const fromLine = blueLine.includes(from) ? blueLine : greenLine.includes(from) ? greenLine : null;
    const toLine = blueLine.includes(to) ? blueLine : greenLine.includes(to) ? greenLine : null;

    if (!fromLine || !toLine) {
        return "Invalid station selection.";
    }

    if (fromLine === toLine) {
        return getStationsBetweenSameLine(fromLine, from, to);
    }

    const interchange = getOptimalInterchange(from, to);
    if (!interchange) {
        return "No valid interchange found.";
    }

    const firstSegment = getStationsBetweenSameLine(fromLine, from, interchange);
    const secondSegment = getStationsBetweenSameLine(toLine, interchange, to);

    return [...firstSegment, ...secondSegment.slice(1)];
}

/**
 * Helper function to get stations between two stations on the same line.
 */
 function getStationsBetweenSameLine(line, from, to) {
    const fromIndex = line.indexOf(from);
    const toIndex = line.indexOf(to);
    if (fromIndex === -    -1 || toIndex === -1 || fromIndex > toIndex) {
        return "Invalid stations or order.";
    }
    return line.slice(fromIndex, toIndex + 1);
}

/**
 * Helper function to find optimal interchange station.
 */
function getOptimalInterchange(from, to) {
    // Check if both stations are on different lines and return the first interchange station found
    return interchanges.find(station => blueLine.includes(station) && greenLine.includes(station));
}

// Function to parse CSV data
function parseCSV(data) {
    const lines = data.split("\n");
    const stations = lines[0].split(",").slice(1).sort(); // Sort stations alphabetically
    const fareData = {};

    lines.slice(1).forEach((line) => {
        const [fromStation, ...fares] = line.split(",");
        fares.forEach((fare, index) => {
            if (fare) {
                const toStation = stations[index];
                fareData[`${fromStation}-${toStation}`] = parseFloat(fare);
            }
        });
    });

    return { stations, fareData };
}

// Load CSV locally
const csvPath = "metro-fare/fare-chart-english.csv";
fetch(csvPath)
    .then((response) => response.text())
    .then((data) => {
        const { stations, fareData } = parseCSV(data);

        const fromStationSelect = document.getElementById("fromStation");
        const toStationSelect = document.getElementById("toStation");

        // Populate dropdowns
        stations.forEach((station) => {
            const option = document.createElement("option");
            option.value = station;
            option.innerText = '◉' + ' ' + station;
            fromStationSelect.appendChild(option.cloneNode(true));
            toStationSelect.appendChild(option);
        });

        // Calculate fare and display route details
        function calculateFare() {
            const fromStation = fromStationSelect.value;
            const toStation = toStationSelect.value;
            const fareOutput = document.getElementById("fareOutput");

            if (fromStation && toStation && fromStation !== toStation) {
                const fareKey = `${fromStation}-${toStation}`;
                const reverseFareKey = `${toStation}-${fromStation}`;
                const fare = fareData[fareKey] || fareData[reverseFareKey];

                if (fare) {
                    const discountedFare = (fare * 0.8).toFixed(2);
                    fareOutput.style.display = "block";
                    fareOutput.className = "alert alert-info";
                    fareOutput.innerHTML = `
                        <h5> Fare Details </h5>
                        <div class="table-responsive">
                            <table class="table table-bordered">
                                <thead>
                                    <tr>
                                        <th>Basic Fare</th>
                                        <th>Discounted Fare (20% Off)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>₹${fare}</strong></td>
                                        <td><strong>₹${discountedFare}</strong></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    `;

                    // Display the route details based on the selected stations
                    displayRouteDetails(fromStation, toStation);
                } else {
                    fareOutput.style.display = "block";
                    fareOutput.className = "alert alert-danger";
                    fareOutput.innerText = "No fare data available for this route.";
                }
            } else {
                fareOutput.style.display = "block";
                fareOutput.className = "alert alert-danger";
                fareOutput.innerText = "Please select valid stations.";
            }
        }

        // Event listeners
        fromStationSelect.addEventListener("change", calculateFare);
        toStationSelect.addEventListener("change", calculateFare);
    })
    .catch((error) => {
        console.error("Error loading the CSV:", error);
        const fareOutput = document.getElementById("fareOutput");
        fareOutput.style.display = "block";
        fareOutput.className = "alert alert-danger";
        fareOutput.innerText = "Error loading fare data.";
    });
</script>


<footer class="text-center mt-3" style="font-size: 14px;">
    <hr>
    <p> <a href="about.html">About News of Chennai</a> | Join our <a href="https://whatsapp.com/channel/0029VaAue85AzNc3O13E7Q2l">WhatsApp Channel</a> | Follow on <a href="https://www.instagram.com/newsofchennai/">Instagram</a>, <a href="https://x.com/newsofchennai">Twitter</a>, <a href="https://www.linkedin.com/company/newsofchennai/">LinkedIn</a> & <a href="https://www.facebook.com/newsofchennai">Facebook</a> | Contact - newsofchennai@pm.me | <a href="credits.html">Credits & Disclaimer</a> | No ads, No Promotions</p>
</footer>
</body>
</html>