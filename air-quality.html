<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chennai Air Quality</title>
    <link rel="icon" href="favicon.png" type="image/x-icon">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        #map-container {
            height: 300px;
            display: none; /* Hide the map by default */
        }
        .aqi-box {
            text-align: center;
            padding: 10px;
            font-weight: bold;
            color: black;
        }
        .aqi-table {
            width: 100%;
            margin-top: 20px;
        }
        .good { background-color: #00e400; }
        .moderate { background-color: #ffff00; }
        .unhealthy-sensitive { background-color: #ff7e00; }
        .unhealthy { background-color: #ff0000; }
        .very-unhealthy { background-color: #660099; }
        .hazardous { background-color: #7e0023; }
        .two-column {
            display: flex;
            justify-content: space-between;
        }
        .column {
            width: 48%;
        }
        .aqi-table {
            width: 100%;
            margin-top: 20px;
            font-size: small;
        }
        .aqi-info{
            border: 2px solid whitesmoke;
            border-radius: 5px;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5);
            padding: 10px;
        }
        /* Scroll-up button styles */
        #scrollUpBtn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: none;
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            z-index: 999;
        }
        @media (max-width: 600px) {
            .two-column {
                flex-direction: column;
            }
            .column {
                width: 100%;
            }
        }
    </style>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <link href="styles.css" rel="stylesheet">
</head>
<body>
<div class="container" style="max-width: 800px;">
    <div class="text-center">
        <a href="index.html">
            <img src="NOC2024.png" alt="Banner" class="img-fluid banner-img" />
        </a>
         <!-- Top Ribbon -->
        <div class="top-ribbon">
            <!-- <div class="left-options"> -->
                <a href="index.html" class="btn icon-circle" aria-label="Home">
                    <i class="fas fa-home"></i>
                </a>
                <button class="btn icon-circle" id="theme-toggle" aria-label="Toggle Dark Mode">
                    <i class="fas fa-moon"></i>
                </button>
                <a href="#" class="btn icon-circle"><i class="fa fa-language" aria-hidden="true"></i>
                </a>
                <a class="btn icon-circle" href="https://www.instagram.com/newsofchennai/" target="_blank"><i class="fab fa-instagram"></i></a>
                <a class="btn icon-circle" href="https://www.facebook.com/newsofchennai" target="_blank"><i class="fab fa-facebook"></i></a>
                <a class="btn icon-circle" href="https://x.com/newsofchennai" target="_blank"><i class="fab fa-twitter"></i></a>
            <!-- </div> -->
        </div>
    </div>
    <hr>
    <center><h2>Chennai Air Quality and Sub-Stations</h2></center>

    <!-- <label for="station-select">Select your nearest location: </label> -->
    <select id="station-select" class="form-control w-lg-50 w-sm-100">
        <option value="">Select your nearest location</option>
        <option value="H13740">Arumbakkam</option>
        <option value="H12431">Alandur Bus Depot</option>
        <option value="H14701">Chengalpattu</option>
        <option value="H7023">Chennai US Consulate</option>
        <option value="H11279">Velachery Res. Area</option>
        <option value="H8185">Manali</option>
        <option value="H11859">Manali Village</option>
        <option value="H13739">Kodungaiyur</option>
        <option value="H13738">Perungudi</option>
        <option value="H13737">Royapuram</option>
    </select>

    <div class="row mt-4">
        <div class="col-md-6">
            <div class="aqi-info" style="display: none;">
                <div id="aqi-details"></div>
            </div>
        </div>

        <div class="col-md-6">
            <div id="map-container"></div>
        </div>
    </div>
    <hr>
    <div class="row">
        <div class="col-12">
            <h5 style="text-decoration:underline;">About the Air Quality and Pollution Measurement:</h5>
            <table class="aqi-table table table-bordered" style="padding: 10px;">
                <thead>
                    <tr>
                        <th>AQI</th>
                        <th>Air Pollution Level</th>
                        <th>Health Implications</th>
                        <th>Cautionary Statement (for PM2.5)</th> <!-- New column header -->
                    </tr>
                </thead>
                <tbody>
                    <tr class="good">
                        <td>0 - 50</td>
                        <td>Good</td>
                        <td>Air quality is considered satisfactory, with little or no risk to health.</td>
                        <td>None</td> <!-- Cautionary statement -->
                    </tr>
                    <tr class="moderate">
                        <td>51 - 100</td>
                        <td>Moderate</td>
                        <td>Acceptable air quality; moderate concern for sensitive individuals.</td>
                        <td>Active children and adults, and people with respiratory disease, such as asthma, should limit prolonged outdoor exertion.</td> <!-- Cautionary statement -->
                    </tr>
                    <tr class="unhealthy-sensitive">
                        <td>101 - 150</td>
                        <td>Unhealthy for Sensitive Groups</td>
                        <td>Sensitive groups may experience health effects; the general public may not be affected.</td>
                        <td>Active children and adults, and people with respiratory disease, such as asthma, should limit prolonged outdoor exertion.</td> <!-- Cautionary statement -->
                    </tr>
                    <tr class="unhealthy">
                        <td>151 - 200</td>
                        <td>Unhealthy</td>
                        <td>Health effects for all; sensitive groups may experience more severe issues.</td>
                        <td>Active children and adults, and people with respiratory disease, such as asthma, should avoid prolonged outdoor exertion; everyone else, especially children, should limit prolonged outdoor exertion.</td> <!-- Cautionary statement -->
                    </tr>
                    <tr class="very-unhealthy">
                        <td>201 - 300</td>
                        <td>Very Unhealthy</td>
                        <td>Health warnings issued; everyone likely to experience serious health effects.</td>
                        <td>Active children and adults, and people with respiratory disease, such as asthma, should avoid all outdoor exertion; everyone else, especially children, should limit outdoor exertion.</td> <!-- Cautionary statement -->
                    </tr>
                    <tr class="hazardous">
                        <td>300+</td>
                        <td>Hazardous</td>
                        <td>Health alert indicating serious effects for all individuals.</td>
                        <td>Everyone should avoid all outdoor exertion.</td> <!-- Cautionary statement -->
                    </tr>
                </tbody>
            </table>
        </div>
    </div>    

    <div>Data sourced from <a href="https://aqicn.org/city/chennai//us-consulate/">Chennai - Air Quality Index (AQI)</a></div>
    <!-- Scroll Up Button -->
    <button id="scrollUpBtn" onclick="scrollToTop()">
        <i class="fas fa-arrow-up"></i>
    </button>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
<script>
    // Theme toggle functionality
    const themeToggle = document.getElementById('theme-toggle');
    const themeIcon = document.getElementById('theme-icon');

    themeToggle.addEventListener('click', () => {
        const body = document.body;
        body.classList.toggle('dark-mode');

        // Toggle icon based on dark mode state
        if (body.classList.contains('dark-mode')) {
            themeIcon.classList.remove('fa-moon'); // Remove moon icon
            themeIcon.classList.add('fa-sun');     // Add sun icon for light mode
        } else {
            themeIcon.classList.remove('fa-sun');  // Remove sun icon
            themeIcon.classList.add('fa-moon');     // Add moon icon for dark mode
        }
    });

    const apiKey = '9eaa5b53392b2983fdc8e5e67bc0c7fdc28e38fd';
    const baseApiUrl = 'https://api.waqi.info/feed/@';
    let map;

    const stationUrls = {
        "H13740": `${baseApiUrl}H13740/?token=${apiKey}`,
        "H12431": `${baseApiUrl}H12431/?token=${apiKey}`,
        "H14701": `${baseApiUrl}H14701/?token=${apiKey}`,
        "H7023": `${baseApiUrl}H7023/?token=${apiKey}`,
        "H11279": `${baseApiUrl}H11279/?token=${apiKey}`,
        "H8185": `${baseApiUrl}H8185/?token=${apiKey}`,
        "H11859": `${baseApiUrl}H11859/?token=${apiKey}`,
        "H13739": `${baseApiUrl}H13739/?token=${apiKey}`,
        "H13737": `${baseApiUrl}H13737/?token=${apiKey}`,
        "H13738": `${baseApiUrl}H13738/?token=${apiKey}`,
    };

    const coordinates = {
        "H13740": [13.0827, 80.2707],  // Arumbakkam
        "H12431": [12.9762, 80.2214],  // Alandur Bus Depot
        "H14701": [12.6876, 79.9776],  // Chengalpattu
        "H7023": [13.0604, 80.2548],   // Chennai US Consulate
        "H11279": [12.9698, 80.2235],  // Velachery Res. Area
        "H8185": [13.1687, 80.2666],   // Manali
        "H11859": [13.1744, 80.2593],  // Manali Village
        "H13739": [13.1303, 80.2426],  // Kodungaiyur
        "H13738": [12.9223, 80.2306],  // Perungudi
        "H13737": [13.0939, 80.2935]   // Royapuram
    };

    function initializeMap() {
        map = L.map('map-container').setView([13.0827, 80.2707], 10);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);
    }

    async function loadAQIForAllStations() {
        const stationIds = Object.keys(stationUrls);
        stationIds.forEach(async (stationId) => {
            const aqiData = await fetchAQIData(stationId);
            const coords = coordinates[stationId];
            L.marker(coords).addTo(map)
                .bindPopup(`<strong>${aqiData.city.name.split(',')[0]}</strong><br>AQI: ${aqiData.aqi}`)
                .openPopup();
        });
    }

    async function fetchAQIData(stationId) {
        const response = await fetch(stationUrls[stationId]);
        const data = await response.json();
        return data.data;
    }

    document.getElementById("station-select").addEventListener("change", async function () {
        const selectedStationId = this.value;
        if (selectedStationId) {
            const aqiData = await fetchAQIData(selectedStationId);
            const { aqi, time, iaqi } = aqiData;
            const lastUpdated = new Date(time.s).toLocaleString();
            const cityName = aqiData.city.name.split(',')[0]; // Extract city name up to the first comma
            const healthStatus = getHealthStatus(aqi);

            const pm25 = aqiData.iaqi.pm25 ? aqiData.iaqi.pm25.v : 'N/A';
            const pm10 = aqiData.iaqi.pm10 ? aqiData.iaqi.pm10.v : 'N/A';

            // Show AQI details
            const aqiDetails = document.getElementById("aqi-details");
            aqiDetails.innerHTML = `
                <strong> <h4 style="text-decoration:underline;">${cityName}</h4></strong>
                <div class="aqi-box ${getAQIClass(aqi)}">AQI Level : ${aqi} | ${healthStatus}</div><br>
                <div>PM<sub>2.5</sub>: ${pm25} µg/m³</div><br>
                <div>PM<sub>10</sub>: ${pm10} µg/m³</div><br>
                <div>Last updated: ${lastUpdated}</div></strong>
            `;
            document.querySelector(".aqi-info").style.display = "block";

            // Show map
            document.getElementById("map-container").style.display = "block";
            map.setView(coordinates[selectedStationId], 13);
            L.marker(coordinates[selectedStationId]).addTo(map)
                .bindPopup(`<strong>${aqiData.city.name.split(',')[0]}</strong><br>AQI: ${aqi}`)
                .openPopup();
        } else {
            document.querySelector(".aqi-info").style.display = "none";
            document.getElementById("map-container").style.display = "none"; // Hide map if no selection
        }
    });
    function getHealthStatus(aqiValue) {
        if (aqiValue <= 50) return 'Good';
        if (aqiValue <= 100) return 'Moderate';
        if (aqiValue <= 150) return 'Unhealthy for Sensitive Groups';
        if (aqiValue <= 200) return 'Unhealthy';
        if (aqiValue <= 300) return 'Very Unhealthy';
        return 'Hazardous';
    }
    function getAQIClass(aqi) {
        if (aqi <= 50) return 'good';
        if (aqi <= 100) return 'moderate';
        if (aqi <= 150) return 'unhealthy-sensitive';
        if (aqi <= 200) return 'unhealthy';
        if (aqi <= 300) return 'very-unhealthy';
        return 'hazardous';
    }

    // Initialize
    initializeMap();
    loadAQIForAllStations();// Scroll to top function
        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Show scroll-up button on scroll
        window.onscroll = function() {
            if (document.body.scrollTop > 100 || document.documentElement.scrollTop >
            100) {
                document.getElementById('scrollUpBtn').style.display = 'block';
            } else {
                document.getElementById('scrollUpBtn').style.display = 'none';
            }
        };
    </script>
    <footer class="text-center mt-5" style="font-size: 14px;">
        <hr>
        <p>Join the <a href="https://whatsapp.com/channel/0029VaAue85AzNc3O13E7Q2l">WhatsApp Channel</a> | Follow on <a href="https://www.instagram.com/newsofchennai/">Instagram</a>, <a href="https://x.com/newsofchennai">Twitter</a>, <a href="https://www.linkedin.com/company/newsofchennai/">LinkedIn</a> & <a href="https://www.facebook.com/newsofchennai">Facebook</a> | Contact - newsofchennai@pm.me <br> News of Chennai is a citizen service that has been functioning since 2020, providing reliable and verified information to citizens in times of need. <br> Weather data sourced from <a href="https://www.weatherunion.com/">Weather Union</a> based on on-ground network of weather stations installed across Chennai.</p>
    </footer>
</body>
</html>
